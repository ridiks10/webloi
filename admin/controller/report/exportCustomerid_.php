<?php/** * PHPExcel * * Copyright (C) 2006 - 2014 PHPExcel * * This library is free software; you can redistribute it and/or * modify it under the terms of the GNU Lesser General Public * License as published by the Free Software Foundation; either * version 2.1 of the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU * Lesser General Public License for more details. * * You should have received a copy of the GNU Lesser General Public * License along with this library; if not, write to the Free Software * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA * * @category   PHPExcel * @package    PHPExcel * @copyright  Copyright (c) 2006 - 2014 PHPExcel (http://www.codeplex.com/PHPExcel) * @license    http://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt	LGPL * @version    1.8.0, 2014-03-02 */class ControllerReportExportCustomerid extends Controller {	public function export() {/** Error reporting */error_reporting(E_ALL);ini_set('display_errors', TRUE);ini_set('display_startup_errors', TRUE);date_default_timezone_set('Europe/London');if (PHP_SAPI == 'cli')	die('This example should only be run from a Web Browser');/** Include PHPExcel */	require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');			$results = $this -> model_sale_customer -> getCustomerByid_($_GET['customer_id']);			//echo "<pre>"; print_r($results); echo "</pre>"; die();			//echo "<pre>"; print_r($results); echo "</pre>"; die();		!count($results) > 0 && die('no data!');			$objPHPExcel = new PHPExcel();			$objPHPExcel->getProperties()->setCreator("Hoivien")							 ->setLastModifiedBy("Hoivien")							 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))							 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))							 ->setDescription($this->language->get('heading_title'))							 ->setKeywords("office 2007 openxml php")							 ->setCategory("Test result file");			$objPHPExcel->setActiveSheetIndex(0)            ->setCellValue('A1', 'Username')            ->setCellValue('B1', 'Citizenship Card/Passport No')            ->setCellValue('C1', 'Email Address')            ->setCellValue('D1', 'Parrent name')            ->setCellValue('E1', 'Password')            ->setCellValue('F1', 'Status')            ->setCellValue('G1', 'Payment')            ->setCellValue('H1', 'Country')            ->setCellValue('I1', 'Phone Number')            ->setCellValue('K1', 'Level')            ->setCellValue('L1', 'Joined')             ->setCellValue('M1', 'Binary');             $objPHPExcel->getActiveSheet()->getStyle('A1:M1')            ->applyFromArray(                    array(                        'fill' => array(                            'type' => PHPExcel_Style_Fill::FILL_SOLID,                            'color' => array('rgb' => '0066FF')                        )                    )                );                $styleArray = array(                    'font'  => array(                        'bold'  => true,                        'color' => array('rgb' => 'FFFFFF'),                        'size'  => 12,                        'name'  => 'Arial'                    ));            $objPHPExcel->getActiveSheet()->getStyle('A1:M1')->applyFromArray($styleArray);			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(15);			$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(15);			$h=0;			$n = 2;			foreach ($results as $customer) {				$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$customer['username']);				$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,$customer['cmnd']);				$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['email']);				$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['lastname']);				$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['password']);				if (intval($customer['status']) ==1)  $status =  "Disable"; else $status = "Enlable";				$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,$status);				if ($customer['payment'] ==1)  $payment =  "Enlable"; else $payment = "Disable";				$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$payment);				$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['country']);				$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,$customer['telephone']);				$objPHPExcel->getActiveSheet()->setCellValue('K'.$n,$customer['check_Newuser']);				$date_added =  date('d/m/Y',strtotime($customer['date_added']));				$objPHPExcel->getActiveSheet()->setCellValue('L'.$n,$date_added);				$objPHPExcel->getActiveSheet()->setCellValue('M'.$n,$customer['p_binary']);				$n++;			}			$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)			->applyFromArray(				array('font'  => array(					'bold'  => true,					'size'  => 12,					'name'  => 'Arial'				))			);			// Rename worksheet			$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));			// Set active sheet index to the first sheet, so Excel opens this as the first sheet			$objPHPExcel->setActiveSheetIndex(0);			// Redirect output to a client’s web browser (Excel5)			header('Content-Type: application/vnd.ms-excel');			header('Content-Disposition: attachment;filename="LISTGD.xls"');			header('Cache-Control: max-age=0');			// If you're serving to IE 9, then the following may be needed			header('Cache-Control: max-age=1');			// If you're serving to IE over SSL, then the following may be needed			header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past			header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified			header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1			header ('Pragma: public'); // HTTP/1.0			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');			$objWriter->save('php://output');			exit;	}	public function get_parrent($customer_id){		$this->load->model('sale/customer');		$parrent = $this -> model_sale_customer -> get_customer_parrent($customer_id);		if(count($parrent) > 0){			return $parrent['username'];		}		return 'null';			}	public function get_customer_p_binary($customer_id){		$this->load->model('sale/customer');		$parrent = $this -> model_sale_customer -> get_customer_by_p_binary($customer_id);		if(count($parrent) > 0){			return $parrent['username'];		}		return 'null';	}	public function export_pd_new() {	error_reporting(E_ALL);	ini_set('display_errors', TRUE);	ini_set('display_startup_errors', TRUE);	date_default_timezone_set('Europe/London');	if (PHP_SAPI == 'cli')	die('This example should only be run from a Web Browser');	require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		$this ->model_sale_customer ->update_show_button_excel();		$this -> session ->data['export'] = "export";		$results = $this -> model_sale_customer -> getall_PD_new();		//print_r($results); die;		if (count($results) == 0){			$this -> session ->data['export'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//echo "<pre>"; print_r($results); echo "</pre>"; die();		//echo "<pre>"; print_r($results); echo "</pre>"; die();		!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Số CMND')		->setCellValue('E1', 'Tên tài khoản')		->setCellValue('F1', 'Số tài khoản')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số tiền hưởng')        ->setCellValue('J1', 'Email')        ->setCellValue('K1', 'Số điện thoại')        ->setCellValue('L1', 'Địa chỉ')        ->setCellValue('M1', 'Thời gian tạo')        ->setCellValue('N1', 'Thời gian kết thúc')        ->setCellValue('O1', 'Gói đầu tư');         $objPHPExcel->getActiveSheet()->getStyle('A1:O1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:O1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(20);		$h=0;		$n = 2;		$i=0;		foreach ($results as $customer) {			//$this -> model_sale_customer -> inser_history('+ '.$amount.' VNĐ','Lãi hằng ngày','Lãi % hằng ngày từ gói đầu tư  ('.$value['filled'].' VND)',$value['customer_id']);			$this -> model_sale_customer ->update_wallet_m_20(doubleval($customer['amount'])*0.2,$customer['customer_id']);			//update ví c = 0			$this -> model_sale_customer ->update_wallet_r_0('0',$customer['customer_id']);			//update max_profit = 0			//$this -> model_sale_customer ->update_max_profit_0('0',$customer['id_pd']);			// lưu lịch sử			$this -> model_sale_customer -> inser_history('- '.doubleval($customer['amount'])*0.8.' VNĐ','Rút ví R sau 15 ngày','Rút 80% trực tiếp từ ví R  ('.$customer['amount'].' VNĐ)',$customer['customer_id']);						$i++;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['cmnd']);						$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n, " ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,doubleval($customer['amount'])*0.8." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('J'.$n,$customer['email']);			$objPHPExcel->getActiveSheet()->setCellValue('K'.$n,$customer['telephone']);			$objPHPExcel->getActiveSheet()->setCellValue('L'.$n,$customer['address_cmnd']);			$objPHPExcel->getActiveSheet()->setCellValue('M'.$n,date('d/m/Y H:i',strtotime($customer['date_added'])));			$objPHPExcel->getActiveSheet()->setCellValue('N'.$n,date('d/m/Y H:i',strtotime($customer['date_finish'])));			$objPHPExcel->getActiveSheet()->setCellValue('O'.$n,number_format($customer['filled'])." VNĐ");			$n++;		}		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);		// Redirect output to a client’s web browser (Excel5)		date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="LIST_PD_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');		exit;	}	public function goidautu($customer_id){		$this->load->model('sale/customer');		$goidautu = $this -> model_sale_customer -> getgoidautu($customer_id);		$goidautu = doubleval($goidautu['filled']);		return $goidautu;	}	public function hoahongconghuong($customer_id){		$this -> load -> model('sale/customer');		$count = $this -> model_sale_customer ->  hoahongconghuong($customer_id);		$getgoidautu =$this -> model_sale_customer ->getgoidautu($customer_id);				//print_r($getgoidautu['filled']); die;		$total_binary = 0;		if (doubleval($count['total_pd_left']) >= doubleval($count['total_pd_right']))		{				if (doubleval($getgoidautu['filled']) < 500000000){				$total_binary = doubleval($count['total_pd_right'])*0.1; 			}						if (doubleval($getgoidautu['filled']) >= 500000000 && doubleval($getgoidautu['filled']) < 1000000000){				$total_binary = doubleval($count['total_pd_right'])*0.11; 			}			if (doubleval($getgoidautu['filled']) >= 1000000000){				$total_binary = doubleval($count['total_pd_right'])*0.12; 			}			$this -> model_sale_customer -> update_total_pd_left(doubleval($count['total_pd_left']) - doubleval($count['total_pd_right']), $customer_id);			$this -> model_sale_customer -> update_total_pd_right(0, $customer_id);		}		else		{			if (doubleval($getgoidautu['filled']) < 500000000){				$total_binary = doubleval($count['total_pd_left'])*0.1;				}			if (doubleval($getgoidautu['filled']) >= 500000000 && doubleval($getgoidautu['filled']) < 1000000000){				$total_binary = doubleval($count['total_pd_left'])*0.11;			}			if (doubleval($getgoidautu['filled']) >= 1000000000){				$total_binary = doubleval($count['total_pd_left'])*0.12;			}			$this -> model_sale_customer -> update_total_pd_right(doubleval($count['total_pd_right']) - doubleval($count['total_pd_left']), $customer_id);			$this -> model_sale_customer -> update_total_pd_left(0, $customer_id);		}		if (doubleval($total_binary) >= (doubleval($getgoidautu['filled'])*2) ) {			$total_commission_binary = $getgoidautu['filled']*2;		} else{						$total_commission_binary = $total_binary;		}			$data['total'] = $total_commission_binary;		$data['pd_left'] = doubleval($count['total_pd_left']);		$data['pd_right'] = doubleval($count['total_pd_right']);		$data['goidautu'] = doubleval($getgoidautu['filled']);		return $data;		return $data;	}	public function export_commission_binary() {	error_reporting(E_ALL);	ini_set('display_errors', TRUE);	ini_set('display_startup_errors', TRUE);	date_default_timezone_set('Europe/London');	if (PHP_SAPI == 'cli')	die('This example should only be run from a Web Browser');	require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		$this ->model_sale_customer ->update_show_button_binary();		$this -> session ->data['export'] = "export";		$results = $this -> model_sale_customer -> getall_commission_binary();		//print_r($results); die;		if (count($results) == 0){			$this -> session ->data['export'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//echo "<pre>"; print_r($results); echo "</pre>"; die();		//echo "<pre>"; print_r($results); echo "</pre>"; die();		!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Số CMND')		->setCellValue('E1', 'Tên tài khoản')		->setCellValue('F1', 'Số tài khoản')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số tiền hưởng')        ->setCellValue('J1', 'Email')        ->setCellValue('K1', 'Số điện thoại')        ->setCellValue('L1', 'Địa chỉ')        ->setCellValue('M1', 'Doanh số trái')        ->setCellValue('N1', 'Doanh số phải')        ->setCellValue('O1', 'Gói đầu tư')         ->setCellValue('P1', 'Trạng thái ID');         $objPHPExcel->getActiveSheet()->getStyle('A1:P1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:O1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(20);		$h=0;		$n = 2;		$i=0;		// foreach ($results as $customerss) {		// 	$hoahongconghuong = $this -> hoahongconghuong($customerss['customer_id']);		// 	echo "<pre>"; print_r($hoahongconghuong); echo "</pre>"; die();		// 	$this -> model_sale_customer -> update_total_pd(doubleval($hoahongconghuong), $customerss['customer_id']);		// }		// die();		foreach ($results as $customer) {			//$this -> model_sale_customer -> inser_history('+ '.$amount.' VNĐ','Lãi hằng ngày','Lãi % hằng ngày từ gói đầu tư  ('.$value['filled'].' VND)',$value['customer_id']);			$hoahongconghuong = $this -> hoahongconghuong($customer['customer_id']);			//echo "<pre>"; print_r($hoahongconghuong); echo "</pre>"; die();			if (doubleval($hoahongconghuong['total']) > 0) {						if ($customer['status_r_wallet'] == '0') {				$status_id	='Không';			} else{				$status_id	='Khóa';			}									$this -> model_sale_customer ->update_wallet_m_20(doubleval($hoahongconghuong['total'])*0.2,$customer['customer_id']);			//update ví c = 0						//update max_profit = 0			//$this -> model_sale_customer ->update_max_profit_0('0',$customer['id_pd']);			// lưu lịch sử			$this -> model_sale_customer -> inser_history('- '.number_format(doubleval($hoahongconghuong['total'])).' VNĐ','Rút Hoa hồng nhánh yếu sau 15 ngày','Rút 80% hoa hồng nhánh yếu, 20% tái đầu tư',$customer['customer_id']);						$i++;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['cmnd']);						$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n, " ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,number_format(doubleval($hoahongconghuong['total'])*0.8)." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('J'.$n,$customer['email']);			$objPHPExcel->getActiveSheet()->setCellValue('K'.$n,$customer['telephone']);			$objPHPExcel->getActiveSheet()->setCellValue('L'.$n,$customer['address_cmnd']);			$objPHPExcel->getActiveSheet()->setCellValue('M'.$n,number_format($hoahongconghuong['pd_left'])." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('N'.$n,number_format($hoahongconghuong['pd_right'])." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('O'.$n,number_format($hoahongconghuong['goidautu'])." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('P'.$n, $status_id);			$n++;			}		}		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);		// Redirect output to a client’s web browser (Excel5)		date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="HOA_HONG_NHANH_YEU_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');		exit;	}	public function export_c_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		$this ->model_sale_customer ->update_show_button_laihangngay();		$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_sale_customer -> getall_c_wallet();		if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Tên tài khoản')		->setCellValue('E1', 'Số tài khoản')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:L1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		foreach ($results as $customer) {					//			//update ví m 20%			$this -> model_sale_customer ->update_wallet_m_20(doubleval($customer['amount'])*0.2,$customer['customer_id']);			//update ví c = 0			$this -> model_sale_customer ->update_wallet_c_0('0',$customer['customer_id']);			// lưu lịch sử						$this -> model_sale_customer -> inser_history('- '.doubleval($customer['amount'])*0.8.' VNĐ','Rút hàng ngày','Rút 80% trực tiếp từ ví C  ('.$customer['amount'].' VNĐ)',$customer['customer_id']);			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount'])*0.8));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount'])*0.8;		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="HOA_HONG_TRUC_TIEP_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	public function export_c_wallet_19_09() {	error_reporting(E_ALL);	ini_set('display_errors', TRUE);	ini_set('display_startup_errors', TRUE);	date_default_timezone_set('Europe/London');	if (PHP_SAPI == 'cli')	die('This example should only be run from a Web Browser');	require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		$this ->model_sale_customer ->update_show_button_laihangngay();		$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_sale_customer -> getall_c_wallet();		if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Số CMND')		->setCellValue('E1', 'Tên tài khoản')		->setCellValue('F1', 'Số tài khoản')		->setCellValue('G1', 'Số Tiền')        ->setCellValue('H1', 'Ngân hàng')        ->setCellValue('I1', 'Chi nhánh')        ->setCellValue('J1', 'Email')        ->setCellValue('K1', 'Số điện thoại')        ->setCellValue('L1', 'Địa chỉ');         $objPHPExcel->getActiveSheet()->getStyle('A1:L1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:L1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);		$h=0;		$n = 2;		$i=0;		foreach ($results as $customer) {					//			//update ví m 20%			$this -> model_sale_customer ->update_wallet_m_20(doubleval($customer['amount'])*0.2,$customer['customer_id']);			//update ví c = 0			$this -> model_sale_customer ->update_wallet_c_0('0',$customer['customer_id']);			// lưu lịch sử						$this -> model_sale_customer -> inser_history('- '.doubleval($customer['amount'])*0.8.' VNĐ','Rút hàng ngày','Rút 80% trực tiếp từ ví C  ('.$customer['amount'].' VNĐ)',$customer['customer_id']);			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['cmnd']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,doubleval($customer['amount'])*0.8." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('J'.$n,$customer['email']);			$objPHPExcel->getActiveSheet()->setCellValue('K'.$n," ".$customer['telephone']);			$objPHPExcel->getActiveSheet()->setCellValue('L'.$n,$customer['address_cmnd']);			$n++;		}		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="LIST_C_WALLET_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	public function export_c_wallet_new() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		$this ->model_sale_customer ->update_show_button_laihangngay();		$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_sale_customer -> getall_c_wallet();		if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//echo "<pre>"; print_r($results); echo "</pre>"; die();		//echo "<pre>"; print_r($results); echo "</pre>"; die();		!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Số CMND')		->setCellValue('E1', 'Tên tài khoản')		->setCellValue('F1', 'Số tài khoản')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số tiền hưởng')        ->setCellValue('J1', 'Email')        ->setCellValue('K1', 'Số điện thoại')        ->setCellValue('L1', 'Địa chỉ');         $objPHPExcel->getActiveSheet()->getStyle('A1:L1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:L1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);		$h=0;		$n = 2;		$i=0;		print_r($results); die;		foreach ($results as $customer) {			/*$this -> model_sale_customer ->update_wallet_m_20(doubleval($customer['amount'])*0.2,$customer['customer_id']);			//update ví c = 0			$this -> model_sale_customer ->update_wallet_c_0('0',$customer['customer_id']);			// lưu lịch sử						$this -> model_sale_customer -> inser_history('- '.doubleval($customer['amount'])*0.8.' VNĐ','Rút hàng ngày','Rút 80% trực tiếp từ ví C  ('.$customer['amount'].' VNĐ)',$customer['customer_id']);*/						$i++;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['cmnd']);						$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n, " ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,(float)$customer['amount']*0.8." VNĐ");			$objPHPExcel->getActiveSheet()->setCellValue('J'.$n,$customer['email']);			$objPHPExcel->getActiveSheet()->setCellValue('K'.$n,$customer['telephone']);			$objPHPExcel->getActiveSheet()->setCellValue('L'.$n,$customer['address_cmnd']);			$n++;		}		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);		// Redirect output to a client’s web browser (Excel5)		date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="LIST_PD_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');		exit;	}		public function getPD90Before(){		$this->load->model('sale/customer');		$results = $this -> model_sale_customer -> getPD90Before();		if (count($results) > 0){			foreach ($results as $value) {				$amount = ((float)$value['filled'])*0.02;				$this -> model_sale_customer -> update_wallet_r($value['customer_id'],$amount);				$this -> model_sale_customer -> update_max_profit($value['id'],$amount);				//lưu lịch sử				$this -> model_sale_customer -> inser_history('+ '.$amount.' VNĐ','Lãi hằng ngày','Lãi % hằng ngày từ gói đầu tư  ('.$value['filled'].' VND)',$value['customer_id']);			}		}				//update time show button		$this ->model_sale_customer -> update_show_button();				$this -> session ->data['hoahong'] = "hoahong";		$this->response->redirect($this->url->link('pd/statistical', 'token=' . $this->session->data['token'], 'SSL'));			}public function exportpd() {/** Error reporting */	error_reporting(E_ALL);	ini_set('display_errors', TRUE);	ini_set('display_startup_errors', TRUE);	date_default_timezone_set('Europe/London');	if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');	/** Include PHPExcel */	require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');			$results = $this -> model_sale_customer -> get_pd_current_date();			//echo "<pre>"; print_r($results); echo "</pre>"; die();			//echo "<pre>"; print_r($results); echo "</pre>"; die();		!count($results) > 0 && die('no data!');		foreach ($results as $key => $result) {			$customers[] = array(				'customer_id'    => $result['customer_id'],				'username'  => $result['username'],				'telephone'  => $result['telephone'],				'email'  => $result['email'],				'wallet'  => $result['wallet'],				'date_added'    => $result['date_added'],				'amount'    => $result['filled'],				'status'    => $result['status']			);		}// Create new PHPExcel object			$objPHPExcel = new PHPExcel();// Set document properties			$objPHPExcel->getProperties()->setCreator("Hoivien")							 ->setLastModifiedBy("Hoivien")							 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))							 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))							 ->setDescription($this->language->get('heading_title'))							 ->setKeywords("office 2007 openxml php")							 ->setCategory("Test result file");			$objPHPExcel->setActiveSheetIndex(0)            ->setCellValue('A1', 'STT')            ->setCellValue('B1', 'UserID')            ->setCellValue('C1', 'Username')            ->setCellValue('D1', 'Phone number')            ->setCellValue('E1', 'Email')            ->setCellValue('F1', 'Wallet')            ->setCellValue('G1', 'DateCreate')            ->setCellValue('H1', 'Amount')            ->setCellValue('I1', 'Status');			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(10);			$h=0;			$n = 2;			foreach ($customers as $customer) {				$h++;				$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$h);				$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,$customer['customer_id']);				$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['username']);				$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['telephone']);				$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['email']);				$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,$customer['wallet']);				$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['date_added']);				$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,($customer['amount']/100000000).' BTC');				if (intval($customer['status']) == 0) {					$status = 'Waiting';				}				if (intval($customer['status']) == 1) {					$status = 'Active';				}				if (intval($customer['status']) == 2) {					$status = 'Finish';				}				$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,$status);				$n++;			}			$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)			->applyFromArray(				array('font'  => array(					'bold'  => true,					'size'  => 12,					'name'  => 'Arial'				))			);			// Rename worksheet			$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));			// Set active sheet index to the first sheet, so Excel opens this as the first sheet			$objPHPExcel->setActiveSheetIndex(0);			// Redirect output to a client’s web browser (Excel5)			header('Content-Type: application/vnd.ms-excel');			header('Content-Disposition: attachment;filename="LISTPD.xls"');			header('Cache-Control: max-age=0');			// If you're serving to IE 9, then the following may be needed			header('Cache-Control: max-age=1');			// If you're serving to IE over SSL, then the following may be needed			header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past			header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified			header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1			header ('Pragma: public'); // HTTP/1.0			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');			$objWriter->save('php://output');			exit;	}	public function exportcustomer() {		/** Error reporting */		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')			die('This example should only be run from a Web Browser');		/** Include PHPExcel */		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		$id_customer = $this-> model_sale_customer->getCustomerByid(1);		print_r($id_customer); die;			$results = $this -> model_sale_customer -> get_gd_current_date();			//echo "<pre>"; print_r($results); echo "</pre>"; die();			//echo "<pre>"; print_r($results); echo "</pre>"; die();		!count($results) > 0 && die('no data!');		foreach ($results as $key => $result) {			$customers[] = array(				'customer_id'    => $result['customer_id'],				'username'  => $result['username'],				'telephone'  => $result['telephone'],				'email'  => $result['email'],				'wallet'  => $result['wallet'],				'date_added'    => $result['date_added'],				'amount'    => $result['amount'],				'status'    => $result['status']			);		}// Create new PHPExcel object			$objPHPExcel = new PHPExcel();// Set document properties			$objPHPExcel->getProperties()->setCreator("Hoivien")							 ->setLastModifiedBy("Hoivien")							 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))							 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))							 ->setDescription($this->language->get('heading_title'))							 ->setKeywords("office 2007 openxml php")							 ->setCategory("Test result file");			$objPHPExcel->setActiveSheetIndex(0)            ->setCellValue('A1', 'STT')            ->setCellValue('B1', 'UserID')            ->setCellValue('C1', 'Username')            ->setCellValue('D1', 'Phone number')            ->setCellValue('E1', 'Email')            ->setCellValue('F1', 'Wallet')            ->setCellValue('G1', 'DateCreate')            ->setCellValue('H1', 'Amount')            ->setCellValue('I1', 'Status');			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(30);			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(10);			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(10);			$h=0;			$n = 2;			foreach ($customers as $customer) {				$h++;				$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$h);				$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,$customer['customer_id']);				$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['username']);				$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['telephone']);				$objPHPExcel->getActiveSheet()->setCellValue('E'.$n,$customer['email']);				$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,$customer['wallet']);				$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['date_added']);				$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,($customer['amount']/100000000).' BTC');				if (intval($customer['status']) == 0) {					$status = 'Waiting';				}				if (intval($customer['status']) == 1) {					$status = 'Active';				}				if (intval($customer['status']) == 2) {					$status = 'Finish';				}				$objPHPExcel->getActiveSheet()->setCellValue('I'.$n,$status);				$n++;			}			$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)			->applyFromArray(				array('font'  => array(					'bold'  => true,					'size'  => 12,					'name'  => 'Arial'				))			);			// Rename worksheet			$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));			// Set active sheet index to the first sheet, so Excel opens this as the first sheet			$objPHPExcel->setActiveSheetIndex(0);			// Redirect output to a client’s web browser (Excel5)			header('Content-Type: application/vnd.ms-excel');			header('Content-Disposition: attachment;filename="LISTGD.xls"');			header('Cache-Control: max-age=0');			// If you're serving to IE 9, then the following may be needed			header('Cache-Control: max-age=1');			// If you're serving to IE over SSL, then the following may be needed			header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past			header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified			header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1			header ('Pragma: public'); // HTTP/1.0			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');			$objWriter->save('php://output');			exit;	}	public function export_r_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		//$this ->model_sale_customer ->update_show_button_laihangngay();		$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_sale_customer -> laihangngay();		if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Tên tài khoản')		->setCellValue('E1', 'Số tài khoản')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:L1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		//print_r($results); die;		foreach ($results as $customer) {					//			//update ví m 20%			$this -> model_sale_customer ->update_wallet_m_20(doubleval($customer['amount'])*0.2,$customer['customer_id']);			//update ví r = 0			$this -> model_sale_customer ->update_wallet_r_0('0',$customer['customer_id']);			// lưu lịch sử						$this -> model_sale_customer -> inser_history('- '.number_format(doubleval($customer['amount'])*0.8).' VNĐ','Rút Lãi Tĩnh','Rút 80% trực tiếp từ ví R  ('.number_format($customer['amount']).' VNĐ)',$customer['customer_id']);			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount'])*0.8));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount'])*0.8;		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="RUT_LAI_TINH_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	public function export_ch_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->language('sale/customer');		$this->load->model('sale/customer');		//update time show button		//$this ->model_sale_customer ->update_show_button_laihangngay();		$this -> session ->data['laiconghuong'] = "laiconghuong";		$results = $this -> model_sale_customer -> laiconghuong();		if (count($results) == 0){			$this -> session ->data['laiconghuong'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Họ tên')		->setCellValue('D1', 'Tên tài khoản')		->setCellValue('E1', 'Số tài khoản')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '0066FF')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:L1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		//print_r($results); die;		foreach ($results as $customer) {					//			//update ví m 20%			$this -> model_sale_customer ->update_wallet_m_20(doubleval($customer['amount'])*0.2,$customer['customer_id']);			//update ví r = 0			$this -> model_sale_customer ->update_wallet_ch_0('0',$customer['customer_id']);			// lưu lịch sử						$this -> model_sale_customer -> inser_history('- '.number_format(doubleval($customer['amount'])*0.8).' VNĐ','Rút Cộng Hưởng','Rút 80% trực tiếp từ ví CH  ('.number_format($customer['amount']).' VNĐ)',$customer['customer_id']);			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['firstname']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount'])*0.8));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount'])*0.8;		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="RUT_CONG_HUONG_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}}